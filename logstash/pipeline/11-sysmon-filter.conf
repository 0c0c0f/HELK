filter {
    if [Channel] == "Microsoft-Windows-Sysmon/Operational" {
        if [event_id] == 1 {
            kv {
                source => "[event_data][Hashes]"
                field_split => ","
                value_split => ":"
                include_keys => ["SHA1", "MD5", "IMPHASH"]
            }
        }
        mutate {
            rename => { "[event_data][CommandLine" => "[process][commandline]" } 
            rename => { "[event_data][CurrentDirectory" => "current_directory" }
            rename => { "[event_data][Hashes][SHA1]" => "sha1" }
            rename => { "[event_data][Hashes][MD5]" => "md5" }
            rename => { "[event_data][Hashes][IMPHASH]" => "imphash" }
            rename => { "[event_data][Image]" => "process"}
            rename => { "[event_data][ImageLoaded" => "[process][module][loaded]"}
            rename => { "[event_data][Signature]" => "[process][module][signature]"}
            rename => { "[event_data][Signature]" => "[process][module][signature][status]"}
            rename => { "[event_data][Signature]" => "[process][module][signed"}
            rename => { "[event_data][IntegrityLevel]" => "[integrity][level]"}
            rename => { "[event_data][LogonGuid]" => "[logon][guid]"}
            rename => { "[event_data][ParentCommandLine]" => "[parent][process][commandline]"}
            rename => { "[event_data][ParentImage]" => "[parent][process]"}
            rename => { "[event_data][ParentProcessGuid]" => "[parent][process][guid]"}
            rename => { "[event_data][ParentProcessId]" => "[parent][process][id]"}
            rename => { "[event_data][ProcessGuid]" => "[process][guid]"}
            rename => { "[event_data][ProcessId]" => "[process][id]"}
            rename => { "[event_data][TerminalSessionId]" => "[terminal][session][id]"}
            rename => { "[event_data][User]" => "user" }
            rename => { "[event_data][NewThreatId]" => "[process][module][threadid]" }
            rename => { "[event_data][StartAddress]" => "[process][module][start][address]" }
            rename => { "[event_data][StartFunction]" => "[process][module][start][function]" }
            rename => { "[event_data][StartModule]" => "[process][module][start]" }
            rename => { "[event_data][Device]" => "Device" }
            rename => { "[event_data][TargetFilename]" => "[file][name]" }
            rename => { "[event_data][CreationUtcTime]" => "[file][time][creation]" }
            rename => { "[event_data][CallTrace]" => "[process][access][calltrace]" }
            rename => { "[event_data][GrantedAccess]" => "[process][access][code]" }
            rename => { "[event_data][SourceImage]" => "[process][source]" }
            rename => { "[event_data][SourceProcessGUID]" => "[process][source][guid]" }
            rename => { "[event_data][SourceProcessId]" => "[process][source][id]" }
            rename => { "[event_data][SourceThreadId]" => "[process][source][threatid]" }
            rename => { "[event_data][TargetImage]" => "[process][target]" }
            rename => { "[event_data][TargetProcessGUID]" => "[process][target][guid]" }
            rename => { "[event_data][TargetProcessId]" => "[process][target][id]" }
            rename => { "[event_data][DestinationHostname]" => "[destination][hostname]" }
            rename => { "[event_data][DestinationIp]" => "[destination][ip]" }
            rename => { "[event_data][DestinationIsIpv6]" => "[destination][is][ipv6]" }
            rename => { "[event_data][DestinationPort]" => "[destination][port][number]" }
            rename => { "[event_data][DestinationPortName]" => "[destination][port][name]" }
            rename => { "[event_data][Initiated]" => "initiated" }
            rename => { "[event_data][Protocol]" => "protocol" }
            rename => { "[event_data][SourceHostname]" => "[source][hostname]" }
            rename => { "[event_data][SourceIp]" => "[source][ip]" }
            rename => { "[event_data][SourceIsIpv6]" => "[source][is][ipv6]" }
            rename => { "[event_data][SourcePort]" => "[source][port][number]" }
            rename => { "[event_data][SourcePortName]" => "[source][port][name]" }
            rename => { "[event_data][EventType]" => "[registry][event][type]" }
            rename => { "[event_data][TargetObject]" => "[registry][key]" }
            rename => { "[event_data][Details]" => "[registry][details]" }
            rename => { "[event_data][PipeName]" => "[pipe][name]" }
            rename => { "[event_data][UtcTime]" => "[event][timestamp][utc]"}
        }
    }
}